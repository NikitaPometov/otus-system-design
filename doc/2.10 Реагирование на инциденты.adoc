=== Реагирование на инциденты

Реагирование на инциденты запускается при достижении порогов по метрикам,
выходе за SLO или устойчивом ухудшении скользящих средних; цель — быстро
восстановить работоспособность, локализовать влияние и устранить причину
отклонения.

Реагирование на отклонения по метрикам

Для всех сервисов
[loweralpha]
.. Отношение числа неуспешных запросов к числу успешных -> резкое повышение
скользящего среднего требует от оунера: провести оценку силами команд
разработки и поддержки, восстановить работоспособность (откатить недавние
изменения, дообаготить данные или совершить иные необходимые действия по
 ситуации), провести расследование и опубликовать post mortem.
.. Время запроса на ответы -> превышение SLO требует от сопровождения поднять
новый инстанс и от оунера преодоления деградации.
.. Используемая RAM -> превышение порога требует от сопровождения поднять
новый инстанс или выделить больше RAM на поду.

[arabic]
. Сервис товаров
[loweralpha]
.. Частота использования индексов -> снижение ниже порога требует удаления
неиспользуемых индексов от DBA.
. Сервис корзины
[loweralpha]
.. Среднее время между чтениями корзины -> превышение скользящего среднего
выше порога требует от архитектора решения об увеличении TTL или смены
хранилища.
. Сервис заказов
[loweralpha]
.. Число незавершённых заказов -> увеличение скользящего среднего требует от
бизнес-аналитиков и оунера диагностики и плана мероприятий.
. Сервис платежей
[loweralpha]
.. Число неуспешных ответов Платёжного шлюза -> превышение порогового
значения — business critical issue, требующее от оунера диагностики и решения
с возможным привлечением других стейкхолдеров.
. Сервис проверки адресов
[loweralpha]
.. Число неуспешных ответов от Системы проверки адресов -> при превышении
порога автоматически перейти на нечёткий поиск по кэшу и/или сменить Систему
проверки адресов
. Сервис уведомлений
[loweralpha]
.. Отношение числа успешных ответов к числу неуспешных от Системы
уведомлений -> при превышении порога требует от бизнеса сменить Систему
уведомлений

План DR (disaster recovery)
[arabic]
. Сценарии
[loweralpha]
.. Потеря зоны/кластера.
.. Недоступность критичных внешних систем (платёжный шлюз, проверка адресов,
система уведомлений).
.. Повреждение данных.
. Подготовка
[loweralpha]
.. Настроить резервное копирование баз данных и конфигураций каждые 5 минут.
.. Поддерживать инфраструктуру развертывания в резервной зоне/кластере.
.. Документировать процедуры переключения и отката.
. Реагирование
[loweralpha]
.. Зафиксировать инцидент и объявить режим DR.
.. Оценить масштаб и выбрать сценарий восстановления.
.. Выполнить переключение на резервную зону/кластер.
.. Восстановить данные из бэкапов при необходимости.
.. Проверить работоспособность и вернуть сервисы в штатный режим.
. Коммуникации
[loweralpha]
.. Назначить ответственных и каналы связи.
.. Сообщить стейкхолдерам о статусе и ETA восстановления.
.. Зафиксировать действия и решения для постмортема.

Проверка плана DR
[arabic]
. Регламент
[loweralpha]
.. Проводить учения не реже 1 раза в полгода.
.. Обновлять план после изменений архитектуры и значимых инцидентов.
. Форматы проверок
[loweralpha]
.. Tabletop-упражнения с разбором сценариев.
.. Тестовые переключения в резервную зону/кластер на непиковых окнах.
.. Восстановление из бэкапа с верификацией целостности данных.
. Метрики эффективности
[loweralpha]
.. Фактические RTO/RPO по результатам учений.
.. Время выявления и начала восстановления.
. Артефакты
[loweralpha]
.. Отчёт об учениях
.. Список улучшений, план корректирующих действий.
