syntax = "proto3";

package otus.systemdesign.v1;

import "common.proto";

service CartService {
  rpc GetCart(GetCartRequest) returns (CartResponse);
  rpc AddItem(AddItemRequest) returns (CartResponse);
  rpc UpdateItem(UpdateItemRequest) returns (CartResponse);
  rpc RemoveItem(RemoveItemRequest) returns (CartResponse);
  rpc ClearCart(ClearCartRequest) returns (CartResponse);

  rpc GetCartForCheckout(GetCartForCheckoutRequest) returns (CartResponse);
}

message CartRef {
  oneof ref {
    string cart_id = 1; // UUID
    UserIdentity owner = 2;
  }
}

message GetCartRequest {
  CartRef cart = 1;
  bool include_goods = 2;
}

message AddItemRequest {
  CartRef cart = 1;
  string goods_id = 2; // UUID
  int32 quantity = 3; // >= 1
}

message UpdateItemRequest {
  CartRef cart = 1;
  string goods_id = 2; // UUID
  int32 quantity = 3; // >= 1
}

message RemoveItemRequest {
  CartRef cart = 1;
  string goods_id = 2; // UUID
}

message ClearCartRequest {
  CartRef cart = 1;
}

message CartResponse {
  Cart cart = 1;
  Money total_amount = 2;
}

message GetCartForCheckoutRequest {
  CartRef cart = 1;
}
